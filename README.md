# CASL2 Simulator

[![Language](https://img.shields.io/badge/Language-C-blue.svg)](https://en.wikipedia.org/wiki/C_(programming_language))
[![Platform](https://img.shields.io/badge/Platform-Unix%2FLinux-lightgrey.svg)](https://www.unix.org/)

## 📋 概要

CASL2（CASLⅡ）で記述されたプログラムのオブジェクトファイルを実行・デバッグするための高機能シミュレーターです。
授業で学んだ基礎的な演算命令の実装を土台として、**独自に機能拡張・性能最適化を行い**、実用的なデバッグ環境を構築しました。

### 🎓 開発背景
- **授業課題**: 基本的なLD/ST命令と四則演算の実装
- **独自拡張**: トレース機能、エラーハンドリング、全命令セット対応、メモリ管理最適化を追加実装

## 🚀 主な機能

### コア機能
- **CASL2オブジェクトファイルの実行**: COMETアセンブラで生成されたオブジェクトファイルを読み込み、仮想マシン上で実行
- **詳細なトレース機能**: 実行中の命令、レジスタ状態、メモリ内容をリアルタイムで監視
- **メモリダンプ機能**: プログラム実行前後のメモリ状態を16進数で表示
- **エラーハンドリング**: アクセス違反、未定義命令、ステップオーバーなどの詳細なエラー検知

### サポートする命令セット
#### 🎯 授業での基礎実装
- **データ転送命令**: LD, ST（基本的なメモリアクセス）
- **算術演算命令**: ADDA, SUBA（符号付き加減算）

#### 🚀 独自拡張実装
- **高度なデータ操作**: LAD（アドレス読み込み）
- **論理演算命令**: AND, OR, XOR（ビット演算の完全実装）
- **比較命令**: CPA, CPL（符号付き・論理比較）
- **シフト命令**: SRL, SLL, SRA, SLA（全4種類のシフト操作）
- **条件分岐命令**: JMI, JNZ, JZE, JUMP, JPL, JOV（フラグベース分岐制御）
- **拡張算術演算**: ADDL, SUBL（論理演算対応）
- **制御命令**: EXIT（プログラム終了制御）

### 実行オプション
- **`-r`**: トレースリスト出力を有効化（命令実行過程の詳細表示）
- **`-s n`**: ステップ数上限設定（最大実行回数制限）

## 🛠️ 技術仕様

### システム要件
- **開発言語**: C言語（C99標準準拠）
- **対応プラットフォーム**: Unix/Linux系OS
- **メモリ容量**: 64KB仮想メモリ空間をサポート
- **レジスタ**: 汎用レジスタ（GR0-GR4）、プログラムレジスタ（PR）、フラグレジスタ（FR）

### アーキテクチャ設計
```
┌─────────────────┐    ┌──────────────────┐    ┌─────────────────┐
│   オブジェクト   │────│  シミュレータ本体  │────│   実行結果出力   │
│   ファイル読込   │    │  (命令実行エンジン) │    │  (トレース/ダンプ) │
└─────────────────┘    └──────────────────┘    └─────────────────┘
```

## 💻 使用方法

### コンパイル
```bash
gcc -o comet c_sim.c
```

### 実行
```bash
# 基本実行
./comet program.com

# トレースリスト表示付き実行
./comet -r program.com

# ステップ数制限付き実行
./comet -s 1000 program.com

# 全オプション組み合わせ
./comet -r -s 1000 program.com
```

### 実行例
```bash
$ ./comet -r sample.com
START ADR = 0x0100
EXEC  ADR = 0x0100

      0100 0101 0102 0103 0104 0105 0106 0107
0100: 1011 0110 F000 0000 0000 0000 0000 0000

ADR   OPCD OPR1 OPR2 MNE     G I X EA   PR   GR0  GR1  GR2  GR3  GR4  MR   FR
0100: 1011      ---- LD      1 0 0 ---- 0101 0000 0000 0000 0000 7FFF 00FF 0000
0101: 0110      ---- LD      0 0 0 ---- 0102 F000 0000 0000 0000 7FFF 00FF 0000
0102: F000      ---- EXIT    - - - ---- ---- F000 0000 0000 0000 7FFF 00FF 0000
TRACE END
```

## 🎯 プロジェクトの技術的価値

### 🎓 授業課題からの発展過程

#### Phase 1: 授業での基礎学習
- 基本的なLD/ST命令の実装
- 単純な加減算処理
- 固定的なメモリ管理

#### Phase 2: 独自の機能拡張
- **全命令セットの実装**: 授業で扱わなかった12種類の命令を独自に調査・実装
- **高度なエラーハンドリング**: アクセス違反、未定義命令、ステップオーバー等の包括的対応
- **リアルタイムトレース機能**: デバッグ支援のための詳細なログ機能を設計・実装

#### Phase 3: 性能・品質向上
- **メモリ管理最適化**: 動的メモリ割り当て、効率的なアドレス計算
- **モジュール化設計**: 各命令を独立関数として実装し、保守性を向上
- **コマンドライン対応**: `-r`, `-s`オプションによる柔軟な実行制御

### 習得した技術スキル
- **低レベルプログラミング**: ビット操作、メモリ直接制御、ハードウェア理解
- **ソフトウェア設計**: 状態管理パターン、エラー処理体系、モジュール分割
- **デバッガ開発**: トレース機能、ステップ実行、レジスタ監視機能の実装
- **自主学習能力**: 仕様書読解、未知の命令セットの独自実装

## 📊 学習・教育価値

このプロジェクトは以下の学習要素を含んでいます：

1. **コンピュータアーキテクチャの理解**: CPU、メモリ、命令セットの動作原理
2. **アセンブリ言語の実践**: 低レベル言語での思考力
3. **デバッガ開発**: ソフトウェア開発ツールの実装経験
4. **テストケース設計**: エラー条件の網羅的な検証

## 🔧 開発環境

- **コンパイラ**: GCC 4.8以上推奨
- **デバッガ**: GDB対応
- **静的解析**: 各種Lintツールに対応
- **テスト**: 単体テスト・統合テスト実装可能

## 📝 ライセンス

本プロジェクトは教育・学習目的で開発されました。

---

> 💡 **採用担当者の方へ**  
> このプロジェクトは、**授業で学んだ基礎知識を実用的なツールに発展させる能力**を示すものです。  
> 
> **主なアピールポイント：**
> - 📚 **自主学習力**: 授業範囲を大幅に超えた機能を独自に実装
> - 🔧 **実装力**: 12種類の追加命令とデバッグ機能を1から設計・開発  
> - 💻 **品質向上意識**: エラーハンドリング、トレース機能等の実用性を重視
> - 🎯 **問題解決能力**: 仕様書から命令セットを理解し、効率的なアルゴリズムで実装
